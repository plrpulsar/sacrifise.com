<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TIS Sacrifice</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        body {
            background-color: #121212;
            color: white;
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
        }

        .container {
            text-align: center;
            background-color: #1a1a1a;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.6);
            padding: 20px;
            margin: 20px;
            width: 90%;
            max-width: 800px;
        }

        h1 {
            color: #00ff7f;
            font-size: 2.5em;
        }

        p, label {
            font-size: 1.2em;
            margin: 10px 0;
        }

        button {
            padding: 10px 20px;
            font-size: 1em;
            background-color: #00ff7f;
            color: black;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #00cc66;
        }

        input[type="number"] {
            width: 80%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #00ff7f;
            border-radius: 5px;
            background-color: #333;
            color: white;
        }

        select {
            padding: 10px;
            background-color: #333;
            color: white;
            border: 1px solid #00ff7f;
            border-radius: 5px;
            margin: 10px 0;
        }

        #countdown {
            font-size: 1.5em;
            color: #00ff7f;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table, th, td {
            border: 1px solid #00ff7f;
        }

        th, td {
            padding: 10px;
            text-align: center;
        }

        th {
            background-color: #00cc66;
            color: black;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>TIS Sacrifice</h1>
        <p id="countdown">El sacrificio comienza el 1 de febrero de 2025</p>

        <button id="connectWallet">Conectar Billetera</button>
        <p id="walletAddress">Dirección: <span>Desconocido</span></p>

        <hr>

        <p><strong>Selecciona el token que sacrificarás:</strong></p>
        <select id="tokenSelect">
            <option value="PLS">PLS</option>
            <option value="WPLS">WPLS</option>
            <option value="INC">INC</option>
            <option value="HEX">HEX</option>
            <option value="WETH">WETH</option>
            <option value="USDT">USDT</option>
        </select>

        <p><strong>Introduce la cantidad a sacrificar:</strong></p>
        <input type="number" id="sacrificeAmount" placeholder="Cantidad a sacrificar">

        <button id="approveTokens">Aprobar Tokens</button>
        <button id="sacrificeTokens">Sacrificar Tokens</button>

        <hr>

        <button id="claimTIS">Reclamar TIS</button>
        <p id="claimStatus">Estado: Aún no has reclamado tus TIS.</p>

        <table>
            <thead>
                <tr>
                    <th>Usuario</th>
                    <th>Token</th>
                    <th>Cantidad</th>
                </tr>
            </thead>
            <tbody id="sacrificeTable">
                <tr>
                    <td colspan="3">Aún no hay sacrificios.</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        const CONTRACT_ADDRESS = "0xAd499C1C9A64E4EE2f43C00836ebF1337ef9e215";
        const ABI = [
            // Reemplazar con el ABI completo del contrato
        ];

        // Countdown
        const countdownElement = document.getElementById("countdown");
        const targetDate = new Date("2025-02-01T00:00:00").getTime();

        function updateCountdown() {
            const now = new Date().getTime();
            const distance = targetDate - now;

            if (distance < 0) {
                countdownElement.textContent = "¡El sacrificio está activo!";
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            countdownElement.textContent = `Faltan ${days}d ${hours}h ${minutes}m ${seconds}s para iniciar.`;
        }

        setInterval(updateCountdown, 1000);

        // Wallet and sacrifice functionality
        let provider, signer, userAddress;

        async function connectWallet() {
            if (typeof window.ethereum !== "undefined") {
                provider = new ethers.providers.Web3Provider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();
                document.getElementById("walletAddress").querySelector("span").textContent = userAddress;
                document.getElementById("connectWallet").textContent = "Billetera Conectada";
                document.getElementById("connectWallet").disabled = true;
            } else {
                alert("MetaMask no está instalada. Por favor, instálala desde https://metamask.io/");
            }
        }

        document.getElementById("connectWallet").addEventListener("click", connectWallet);

        async function approveTokens() {
            alert("Función de aprobación en desarrollo.");
        }

        async function sacrificeTokens() {
            if (!userAddress) {
                alert("Por favor, conecta tu billetera primero.");
                return;
            }

            const amount = document.getElementById("sacrificeAmount").value;
            const token = document.getElementById("tokenSelect").value;

            if (!amount || isNaN(amount) || amount <= 0) {
                alert("Por favor, introduce una cantidad válida.");
                return;
            }

            try {
                const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
                const tx = await contract.sacrificeTokens(ethers.utils.parseUnits(amount, 18));
                await tx.wait();

                alert("¡Sacrificio realizado con éxito!");
                addSacrifice(userAddress, token, amount);
            } catch (error) {
                console.error(error);
                alert("Error al realizar el sacrificio.");
            }
        }

        document.getElementById("sacrificeTokens").addEventListener("click", sacrificeTokens);

        // Claim TIS logic
        document.getElementById("claimTIS").addEventListener("click", async () => {
            if (!userAddress) {
                alert("Por favor, conecta tu billetera primero.");
                return;
            }

            const tableRows = document.querySelectorAll("#sacrificeTable tr");
            let totalPLS = 0;

            tableRows.forEach(row => {
                const cells = row.querySelectorAll("td");
                if (cells.length > 0 && cells[1].textContent === "PLS") {
                    totalPLS += parseFloat(cells[2].textContent);
                }
            });

            const tisToClaim = Math.floor(totalPLS / 100);

            if (tisToClaim > 0) {
                document.getElementById("claimStatus").textContent = `Has reclamado ${tisToClaim} TIS.`;
                alert(`¡Reclamo exitoso! Has recibido ${tisToClaim} TIS.`);
            } else {
                alert("No tienes suficiente PLS sacrificado para reclamar TIS.");
            }
        });

        // Add sacrifice to table
        function addSacrifice(user, token, amount) {
            const table = document.getElementById("sacrificeTable");
            const row = document.createElement("tr");

            row.innerHTML = `
                <td>${user}</td>
                <td>${token}</td>
                <td>${amount}</td>
            `;

            if (table.querySelector("tr td[colspan]") !== null) {
                table.innerHTML = ""; // Clear placeholder
            }

            table.appendChild(row);
        }
    </script>
</body>
</html>
